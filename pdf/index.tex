\href{https://travis-ci.org/markjolah/PriorHessian}{\tt }

\subsection*{Prior Hessian}

Library for fast computation of log-\/likelihoods and derivatives of multivariate priors defined as composites of univariate multivariate distributions especially designed for support of Archimedean copulas.

\subsubsection*{Documentation}

The Prior\+Hessian Doxygen documentation can be build with the {\ttfamily O\+P\+T\+\_\+\+D\+OC} C\+Make option and is also available on online\+:
\begin{DoxyItemize}
\item \href{https://markjolah.github.io/PriorHessian/index.html}{\tt Prior\+Hessian H\+T\+ML Manual}
\item \href{https://markjolah.github.io/PriorHessian/pdf/PriorHessian-0.2-reference.pdf}{\tt Prior\+Hessian P\+DF Manual}
\item \href{https://github.com/markjolah/PriorHessian}{\tt Prior\+Hessian github repository}
\end{DoxyItemize}

\subsubsection*{Installation}

The Prior\+Hessian library uses C\+Make and is designed to be installed either as a native package, or as a relocatable package in an arbitrary install prefix. The default build script will install to the {\ttfamily \+\_\+install} directory underneath the repository root.


\begin{DoxyItemize}
\item {\bfseries Default release build script}
\begin{DoxyItemize}
\item builds to {\ttfamily \$\{B\+U\+I\+L\+D\+\_\+\+P\+A\+TH\}} if set or default of\+: {\ttfamily \$\{C\+M\+A\+K\+E\+\_\+\+S\+O\+U\+R\+C\+E\+\_\+\+D\+IR\}\textbackslash{}\+\_\+build\textbackslash{}Release}
\item installs to {\ttfamily \$\{I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+A\+TH\}} if set or default of\+: {\ttfamily \$\{C\+M\+A\+K\+E\+\_\+\+S\+O\+U\+R\+C\+E\+\_\+\+D\+IR\}\textbackslash{}\+\_\+install} 
\begin{DoxyCode}
1 $ ./build.sh <cmake-extra-opts>
\end{DoxyCode}

\end{DoxyItemize}
\item {\bfseries Default Debug build script}
\begin{DoxyItemize}
\item builds to {\ttfamily \$\{B\+U\+I\+L\+D\+\_\+\+P\+A\+TH\}} if set or default of\+: {\ttfamily \$\{C\+M\+A\+K\+E\+\_\+\+S\+O\+U\+R\+C\+E\+\_\+\+D\+IR\}\textbackslash{}\+\_\+build\textbackslash{}Debug}
\item installs to {\ttfamily \$\{I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+A\+TH\}} if set or default of\+: {\ttfamily \$\{C\+M\+A\+K\+E\+\_\+\+S\+O\+U\+R\+C\+E\+\_\+\+D\+IR\}\textbackslash{}\+\_\+install} 
\begin{DoxyCode}
1 $ ./build.debug.sh <cmake-extra-opts>
\end{DoxyCode}

\end{DoxyItemize}
\item {\bfseries Manual C\+Make Build} 
\begin{DoxyCode}
1 $ cmake -H. -B<build-path> -DCMAKE\_INSTALL\_PREFEX=<install-path> -DCMAKE\_BUILD\_TYPE=Release
       <other-cmake-args>
2 $ cd <build-path> && make -j<num-procs> install
\end{DoxyCode}

\end{DoxyItemize}

\paragraph*{Dependencies}


\begin{DoxyItemize}
\item \href{http://arma.sourceforge.net/docs.html}{\tt {\itshape Armadillo}} -\/ A high-\/performance array library for C++.
\item {\itshape B\+L\+AS} -\/ A B\+L\+AS implemenation\+: \href{http://www.netlib.org/blas/}{\tt Netlib B\+L\+AS reference} or \href{https://www.openblas.net/}{\tt {\itshape Open\+Blas}}
\item {\itshape L\+A\+P\+A\+CK} -\/ A Lapack implemenation\+: \href{http://www.netlib.org/lapack/}{\tt Netlib L\+A\+P\+A\+CK reference}
\end{DoxyItemize}

Note the {\ttfamily O\+P\+T\+\_\+\+B\+L\+A\+S\+\_\+\+I\+N\+T64} C\+Make option controls whether Armadillo uses B\+L\+AS and L\+A\+P\+A\+CK libraries that use 64-\/bit interger indexing. Matlab uses 64-\/bit by default, and to link Prior\+Hessian to Matlab M\+EX libraries, this option must be on. Many linux systems only provide 32-\/bit integer versions of B\+L\+AS and Lapack, and the option can be disabled if Matlab support is not a concern and 64-\/bit support is difficult to manage on

\paragraph*{C\+Make Options}

\subparagraph*{Standard options}


\begin{DoxyItemize}
\item {\ttfamily B\+U\+I\+L\+D\+\_\+\+S\+H\+A\+R\+E\+D\+\_\+\+L\+I\+BS} -\/ Build shared libraries \mbox{[}Default\+: On\mbox{]}
\item {\ttfamily B\+U\+I\+L\+D\+\_\+\+S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+BS} -\/ Build static libraries \mbox{[}Default\+: On\mbox{]}
\item {\ttfamily B\+U\+I\+L\+D\+\_\+\+T\+E\+S\+T\+I\+NG} -\/ Build tests \mbox{[}Default\+: On if {\ttfamily C\+M\+A\+K\+E\+\_\+\+B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE=Debug}\mbox{]}
\item {\ttfamily O\+P\+T\+\_\+\+I\+N\+S\+T\+A\+L\+L\+\_\+\+T\+E\+S\+T\+I\+NG} -\/ Install tests. \mbox{[}Default\+: Off\mbox{]}
\item {\ttfamily O\+P\+T\+\_\+\+D\+OC} -\/ Build and install documentation (enables {\ttfamily make doc} and {\ttfamily make pdf}) \mbox{[}Default\+: Off\mbox{]}
\item {\ttfamily O\+P\+T\+\_\+\+E\+X\+P\+O\+R\+T\+\_\+\+B\+U\+I\+L\+D\+\_\+\+T\+R\+EE} -\/ Enable C\+Make export and {\ttfamily find\+\_\+package(\+Backtrace\+Exception)} support from the build-\/tree.
\end{DoxyItemize}

\subparagraph*{Dependency options}


\begin{DoxyItemize}
\item {\ttfamily O\+P\+T\+\_\+\+B\+L\+A\+S\+\_\+\+I\+N\+T64} -\/ Enable 64-\/bit integer B\+L\+AS library support \mbox{[}Default\+: Off\mbox{]}
\end{DoxyItemize}

\paragraph*{External Projects}

These packages are specialized C\+Make projects. If they are not currently installed on the development machines we use the \href{https://github.com/markjolah/UncommonCMakeModules/blob/master/AddExternalDependency.cmake}{\tt Add\+External\+Dependency.\+cmake} which will automatically download, configure, build and install to the {\ttfamily C\+M\+A\+K\+E\+\_\+\+I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+R\+E\+F\+IX}, enabling their use through the normal C\+Make {\ttfamily find\+\_\+package()} system.


\begin{DoxyItemize}
\item \href{https://github.com/markjolah/BacktraceException}{\tt Backtrace\+Exception} -\/ For exception backtraces when debugging (especially in Matlab).
\end{DoxyItemize}

\subsubsection*{Motivation}

For many likelihood-\/based methods, they can be extended to Bayesian methods like M\+AP Estimation and M\+C\+MC Posterior sampling, by incorporating a prior. This prior must provide fast methods for computing log-\/likelihood and it\textquotesingle{}s derivatives over the parameter space. The prior log-\/likelihood, as well as it\textquotesingle{}s gradient and hessian are then added to the equivalent quantities from the likelihood to create a Bayesian objective for M\+AP Estimation.

\subsubsection*{Static Polymorphism}

The Prior\+Hessian library is designed using static polymorphism (templates), and as such avoids virtual functions for small-\/grained tasks, and instead uses templates, which allow many small functions to be inlined. This aggressive inlining by the compiler produces log-\/likelihood, gradient, and hessian functions that are nearly as fast as hand-\/coded functions. But our flexible \mbox{[}{\ttfamily Composite\+Dist}\mbox{]}() class is able to be easily created with any mix of \mbox{[}{\ttfamily Univariate\+Dist}\mbox{]}() and \mbox{[}{\ttfamily Multivariate\+Dist}\mbox{]}() elements.

In \href{https://github.com/markjolah/Mappel}{\tt Mappel} we use this ability to create heterogeneous priors for each Model\textquotesingle{}s parameters, (e.\+g., \mbox{[}x,y,I,bg,sigma\mbox{]}).

Functionally, the Prior\+Hessian library stores sequences of distributions as {\ttfamily std\+::tuples}. Using this approach as opposed to the runtime polymorphism of using {\ttfamily std\+::vector$<$std\+::unique\+\_\+ptr$<$Base$>$$>$} gains several advantages. Most importantly, without the need for virtual functions, the tuple-\/based approach has the ability to inline the many small computational functions that must be combined for every call to compute the log-\/likelihood or other computationally important quantities. 